<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Borrowed Books - LibraryPNC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/static/css/borrowed_books.css">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header-card">
            <div class="header-content">
                <div class="page-title">
                    <div class="page-icon">
                        <i class="fas fa-book-reader"></i>
                    </div>
                    <div>
                        <h1>My Borrowed Books</h1>
                        <p>Track your current and past book borrowings</p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <h3>{{ borrowed_books|length if borrowed_books else 0 }}</h3>
                        <p>Total Borrowed</p>
                    </div>
                    <div class="stat-card">
                        <h3>
                            {% if borrowed_books %}
                                {{ borrowed_books|selectattr('status', 'equalto', 'issued')|list|length }}
                            {% else %}
                                0
                            {% endif %}
                        </h3>
                        <p>Currently Borrowed</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Books Table -->
        <div class="table-container">
            <div class="table-header">
                <h3><i class="fas fa-list-check"></i> Borrowing History</h3>
            </div>
            
            {% if borrowed_books %}
            <table class="books-table">
                <thead>
                    <tr>
                        <th>Book ID</th>
                        <th>Title</th>
                        <th>Borrow Date</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in borrowed_books %}
                    <tr>
                        <td><span class="book-id">#{{ book.id }}</span></td>
                        <td><span class="book-title">{{ book.title }}</span></td>
                        <td>{{ book.borrow_date.strftime('%Y-%m-%d') if book.borrow_date else '—' }}</td>
                        <td>
                            {% if book.due_date %}
                                <span class="due-date {% if book.is_overdue %}overdue{% endif %}">
                                    {{ book.due_date.strftime('%Y-%m-%d') }}
                                    {% if book.is_overdue %}
                                        <i class="fas fa-exclamation-triangle ms-1"></i>
                                    {% endif %}
                                </span>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td>
                            {% if book.status == 'issued' %}
                                {% if book.is_overdue %}
                                    <span class="status-badge status-overdue">
                                        <i class="fas fa-clock me-1"></i> Overdue
                                    </span>
                                {% else %}
                                    <span class="status-badge status-borrowed">
                                        <i class="fas fa-bookmark me-1"></i> Borrowed
                                    </span>
                                {% endif %}
                            {% else %}
                                <span class="status-badge status-returned">
                                    <i class="fas fa-check-circle me-1"></i> Returned
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-buttons">
                                {% if book.status == 'issued' %}
                                    <a href="{{ url_for('return_book', borrow_id=book.id) }}" class="btn btn-success">
                                        <i class="fas fa-undo-alt"></i> Return
                                    </a>
                                    <a href="{{ url_for('renew_book', book_id=book.id) }}" class="btn btn-primary">
                                        <i class="fas fa-sync-alt"></i> Renew
                                    </a>
                                {% else %}
                                    <span class="text-muted">Completed</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="no-books">
                <i class="fas fa-book-open"></i>
                <h3>No Borrowed Books</h3>
                <p>You haven't borrowed any books yet.</p>
                <a href="{{ url_for('books') }}" class="btn btn-primary mt-3">
                    <i class="fas fa-book me-2"></i> Browse Books
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Add some interactive features
        document.addEventListener('DOMContentLoaded', function() {
            // Add animation to table rows
            const tableRows = document.querySelectorAll('.books-table tbody tr');
            tableRows.forEach((row, index) => {
                row.style.animationDelay = `${index * 0.05}s`;
            });

            // Add confirmation for return actions
            const returnButtons = document.querySelectorAll('.btn-success');
            
            returnButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    if (!confirm('Are you sure you want to return this book?')) {
                        e.preventDefault();
                    }
                });
            });
            
            // Add confirmation for renew actions
            const renewButtons = document.querySelectorAll('.btn-primary');
            
            renewButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    if (!confirm('Are you sure you want to renew this book?')) {
                        e.preventDefault();
                    }
                });
            });
            
            // Highlight overdue books
            const overdueElements = document.querySelectorAll('.due-date.overdue');
            overdueElements.forEach(element => {
                element.closest('tr').style.background = 'rgba(243, 156, 18, 0.05)';
            });
        });
    </script>
</body>
</html>
